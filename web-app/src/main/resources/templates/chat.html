<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<div th:replace="~{layout :: layout(~{::section})}">
    <section class="container-fluid" id="chat-root" th:attr="data-username=${username}">
        <div class="row g-3">
            <aside class="col-12 col-md-3">
                <div class="card bg-body-secondary h-100">
                    <div class="card-header">Online</div>
                    <ul class="list-group list-group-flush" id="online-list">
                        <li class="list-group-item d-flex align-items-center gap-2"
                            th:each="user : ${onlineUsers}">
                            <span class="status-dot bg-success"></span>
                            <span th:text="${user.username()}"></span>
                        </li>
                        <li class="list-group-item text-muted" th:if="${onlineUsers.isEmpty()}">
                            No one online yet.
                        </li>
                    </ul>
                </div>
            </aside>
            <section class="col-12 col-md-9 d-flex flex-column chat-surface">
                <div id="feed" class="flex-grow-1 overflow-auto mb-3">
                    <div th:each="message : ${initialMessages}"
                         th:classappend="${message.mine()} ? 'message message-mine' : 'message'">
                        <small class="text-muted" th:text="${#temporals.format(message.timestamp(), 'HH:mm')}"/>
                        <strong th:text="${message.user()}"></strong>
                        <div th:text="${message.text()}"></div>
                    </div>
                </div>
                <form id="composer" class="d-flex gap-2" method="post" action="/send">
                    <input type="hidden" name="username" th:value="${username}">
                    <input type="text" class="form-control" name="text" placeholder="Message" autocomplete="off">
                    <button class="btn btn-primary" type="submit">Send</button>
                </form>
            </section>
        </div>
        <div id="connection-badge" class="badge bg-success position-fixed bottom-0 start-0 m-3">
            Connected
        </div>
    </section>
    <script th:inline="javascript">
        window.securechat = {
            username: [[${username}]],
            initialMessages: [[${initialMessages}]],
            streamUrl: '/stream?u=' + encodeURIComponent([[${username}]]),
            sendUrl: '/send'
        };
    </script>
</div>
</html>
